#!/bin/bash

ACTION=$1

load () {
    local logfilename="messages"
    local numberofrows=1000
    local logpath="/var/log/$logfilename"
    
    # Check if file exists
    if [ ! -f "$logpath" ]; then
        echo "{\"success\":\"0\",\"error\": \"Log file not found: $logpath\"}"
        return 1
    fi
    
    # Read the log file
    if logs=$(tail -n "$numberofrows" "$logpath" 2>&1); then
        # Escape special characters for JSON
        logs="${logs//\\/\\\\}"
        logs="${logs//\"/\\\"}"
        logs="${logs//$'\n'/\\n}"
        
        echo "{\"success\":\"1\",\"data\":{\"logs\":\"$logs\"},\"readonly\":\"1\"}"
    else
        echo "{\"success\":\"0\",\"error\": \"Failed to read log file\"}"
        return 1
    fi
}

case "$ACTION" in
    load)
        load
        ;;
esac